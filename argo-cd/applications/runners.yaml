applicationsets:
  - name: runners
    generators:
      - list:
          elements:
            - name: benzene-ubuntu
    syncPolicy:
      preserveResourcesOnDeletion: false
    template:
      metadata:
        name: '{{name}}'
        namespace: argocd
        labels:
          app.kubernetes.io/component: arc-runner
      spec:
        project: default
        syncPolicy:
          automated:
            prune: true
          syncOptions:
            - CreateNamespace=true
            - ApplyOutOfSyncOnly=true
        sources:
          - repoURL: https://github.com/benzene-tech/github-runners.git
            targetRevision: main
            ref: values
          - repoURL: ghcr.io/actions/actions-runner-controller-charts
            chart: gha-runner-scale-set
            targetRevision: 0.6.1
            helm:
              releaseName: '{{name}}'
              valueFiles:
                - $values/arc/runners/values.yaml
                - $values/arc/runners/{{name}}.yaml
        destination:
          server: https://kubernetes.default.svc
          namespace: arc-runners
